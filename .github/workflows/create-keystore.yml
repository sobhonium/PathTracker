name: 🔐 Create Keystore for PathTracker

on:
  workflow_dispatch:
    inputs:
      keystore_password:
        description: 'Keystore password (min 6 chars)'
        required: true
        type: string
      key_password:
        description: 'Key password (min 6 chars)'
        required: true
        type: string
      full_name:
        description: 'Your full name'
        required: true
        default: 'PathTracker Developer'
        type: string
      organization:
        description: 'Organization name'
        required: true
        default: 'PathTracker'
        type: string
      city:
        description: 'City'
        required: true
        default: 'Your City'
        type: string
      state:
        description: 'State/Province'
        required: true
        default: 'Your State'
        type: string
      country:
        description: 'Country code (2 letters)'
        required: true
        default: 'US'
        type: string

jobs:
  create-keystore:
    runs-on: ubuntu-latest

    steps:
    - name: 📥 Checkout repository
      uses: actions/checkout@v4

    - name: ☕ Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'

    - name: 🔐 Generate Keystore
      run: |
        keytool -genkeypair \
          -keystore pathtracker-keystore.jks \
          -alias pathtracker \
          -keyalg RSA \
          -keysize 2048 \
          -validity 10000 \
          -storepass "${{ github.event.inputs.keystore_password }}" \
          -keypass "${{ github.event.inputs.key_password }}" \
          -dname "CN=${{ github.event.inputs.full_name }}, OU=Development, O=${{ github.event.inputs.organization }}, L=${{ github.event.inputs.city }}, ST=${{ github.event.inputs.state }}, C=${{ github.event.inputs.country }}"

        echo "✅ Keystore created successfully!"

        # Display keystore info
        keytool -list -keystore pathtracker-keystore.jks -storepass "${{ github.event.inputs.keystore_password }}"

    - name: 📋 Generate GitHub Secrets
      run: |
        echo "🔐 GitHub Secrets to Add:"
        echo "========================"
        echo ""
        echo "🔑 SIGNING_KEY:"
        base64 -w 0 pathtracker-keystore.jks
        echo ""
        echo ""
        echo "🏷️  ALIAS:"
        echo "pathtracker"
        echo ""
        echo "🔒 KEY_STORE_PASSWORD:"
        echo "${{ github.event.inputs.keystore_password }}"
        echo ""
        echo "🗝️  KEY_PASSWORD:"
        echo "${{ github.event.inputs.key_password }}"
        echo ""
        echo "📋 Next Steps:"
        echo "1. Copy the SIGNING_KEY value above (the long base64 string)"
        echo "2. Go to Settings → Secrets and variables → Actions"
        echo "3. Add each of the 4 secrets listed above"
        echo "4. Run the build workflow to create your APK!"

    - name: 📤 Upload Keystore Info
      uses: actions/upload-artifact@v4
      with:
        name: keystore-info
        path: pathtracker-keystore.jks